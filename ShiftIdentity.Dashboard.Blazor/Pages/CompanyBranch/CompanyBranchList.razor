@attribute [Authorize]
@layout Shared.DefaultLayout
@attribute [Route($"{Constants.IdentityRoutePreifix}/{nameof(CompanyBranchList)}")]
@using ShiftSoftware.ShiftIdentity.Core.DTOs.City
@using ShiftSoftware.ShiftIdentity.Core.DTOs.Company
@using ShiftSoftware.ShiftIdentity.Core.DTOs.Department
@using ShiftSoftware.ShiftIdentity.Core.DTOs.Service
@using ShiftSoftware.ShiftEntity.Model.Dtos
@using ShiftSoftware.ShiftIdentity.Core.DTOs.CompanyBranch;
@using ShiftSoftware.ShiftEntity.Model.Enums
@inject ShiftIdentityLocalizer Loc

<ShiftList EntitySet="@($"{Constants.IdentityRoutePreifix}CompanyBranch")"
           Title="@Loc["Company Branch List"]"
           T="CompanyBranchListDTO"
           ComponentType="typeof(CompanyBranchForm)"
           Dense
           DisableFilters
           FilterPanelDefaultOpen
           EnableFilterPanel
           TypeAuthAction="ShiftIdentityActions.CompanyBranches"
           EnableExport>

    <StringFilter Property="x => x.Name" Label="@Loc["Name"]" Operator="ShiftBlazor.Enums.ODataOperator.Contains" lg="3" md="6" sm="12" xs="12" />
    <StringFilter Property="x => x.DisplayName" Label="@Loc["Display Name"]" Operator="ShiftBlazor.Enums.ODataOperator.Contains" lg="3" md="6" sm="12" xs="12" />
    <ForeignFilter Property="x => x.CityId" Label="@Loc["City"]" DTOType="typeof(CityListDTO)" EntitySet="@($"{Constants.IdentityRoutePreifix}City")" lg="3" md="6" sm="12" xs="12" />
    <ForeignFilter Property="x => x.CompanyId" Label="@Loc["Company"]" DTOType="typeof(CompanyListDTO)" EntitySet="@($"{Constants.IdentityRoutePreifix}Company")" lg="3" md="6" sm="12" xs="12" />
    <StringFilter Property="x => x.IntegrationId" Label="@Loc["Integration ID"]" Operator="ShiftBlazor.Enums.ODataOperator.Contains" lg="3" md="6" sm="12" xs="12" />
    <ForeignFilter Property="x => x.Value" DTOType="typeof(DepartmentListDTO)" EntitySet="@($"{Constants.IdentityRoutePreifix}Department")" Label="@Loc["Departments"]" TProperty="string" T="ShiftEntitySelectDTO" CollectionPrefix="@(["Departments"])" lg="3" md="6" sm="12" xs="12" />
    <ForeignFilter Property="x => x.Value" DTOType="typeof(ServiceListDTO)" EntitySet="@($"{Constants.IdentityRoutePreifix}Service")" Label="@Loc["Services"]" TProperty="string" T="ShiftEntitySelectDTO" CollectionPrefix="@(["Services"])" lg="3" md="6" sm="12" xs="12" />
    
  @*   <EnumFilter Property="x => x.PublishTargets"  Label="@Loc["Publish Targets"]"  lg="3" md="6" sm="12" xs="12" /> *@
    
    <DateTimeFilter Property="x => x.TerminationDate" Label="@Loc["TerminationDate"]" Operator="ShiftBlazor.Enums.ODataOperator.Equal" lg="3" md="6" sm="12" xs="12" />
    <DateTimeFilter Property="x => x.CompanyTerminationDate" Label="@Loc["Company TerminationDate"]" Operator="ShiftBlazor.Enums.ODataOperator.Equal" lg="3" md="6" sm="12" xs="12" />

    <PropertyColumn Title="@Loc["Name"]" Property="x => x.Name" />
    <PropertyColumn Title="@Loc["Display Name"]" Property="x => x.DisplayName" />
    <PropertyColumn Title="@Loc["Short Code"]" Property="x => x.ShortCode" />
    <PropertyColumn Title="@Loc["City"]" Property="x => x.City" />
    <PropertyColumn Title="@Loc["Company"]" Property="x => x.Company" />
    <PropertyColumn Title="@Loc["Integration ID"]" Property="x => x.IntegrationId" />
    <PropertyColumn Title="@Loc["Display Order"]" Property="x => x.DisplayOrder" />

    <PropertyColumn Title="@Loc["Departments"]" Property="x => x.Departments" Context="col"> 
        <CellTemplate>
            @foreach (var department in col.Item!.Departments)
            {
                <MudChip Size="Size.Small" Color="Color.Primary">@department.Text</MudChip>
            }
        </CellTemplate>
    </PropertyColumn>

    <PropertyColumn Title="@Loc["Services"]" Property="x => x.Services" Context="col">
        <CellTemplate>  
            @foreach (var service in col.Item!.Services)
            {
                <MudChip Size="Size.Small" Color="Color.Primary">@service.Text</MudChip>
            }
        </CellTemplate>
    </PropertyColumn>

    <PropertyColumnExtended Filterable="false" Sortable="false" Title="@Loc["Publish Targets"]" Property="x => x.PublishTargets" Context="col">
        <CellTemplate>
            @if(col.Item.PublishTargets != null && col.Item.PublishTargets.Any()) 
            {
                @foreach (var target in col.Item!.PublishTargets)
                {
                    <MudChip Size="Size.Small" Color="Color.Primary">@target.Describe()</MudChip>
                }
            }
        </CellTemplate>
    </PropertyColumnExtended>
    <PropertyColumn Property="x => x.TerminationDate" Format="yyyy-MM-dd" Title="@Loc["TerminationDate"]" />
    <PropertyColumn Property="x => x.CompanyTerminationDate" Format="yyyy-MM-dd" Title="@Loc["Company TerminationDate"]" />
</ShiftList>